<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <title>Sunrise Light</title>

    <!-- Bootstrap core CSS -->
    <link href="bootstrap.min.css" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.2/css/all.css">


    <style>
      .bd-placeholder-img {
        font-size: 1.125rem;
        text-anchor: middle;
        -webkit-user-select: none;
        -moz-user-select: none;
        -ms-user-select: none;
        user-select: none;
      }

      @media (min-width: 768px) {
        .bd-placeholder-img-lg {
          font-size: 3.5rem;
        }
      }
      
      body {
          padding-top: 3.5rem;
          }
      
      /* Toggle switch */
      .switch {
          position: relative;
          display: inline-block;
          width: 52px;
          height: 30px;
        }

      .switch input { 
          opacity: 0;
          width: 0;
          height: 0;
        }

      .slider {
          position: absolute;
          cursor: pointer;
          top: 0;
          left: 0;
          right: 0;
          bottom: 0;
          background-color: #ccc;
          -webkit-transition: .4s;
          transition: .4s;
        }

      .slider:before {
          position: absolute;
          content: "";
          height: 23px;
          width: 23px;
          left: 4px;
          bottom: 4px;
          background-color: white;
          -webkit-transition: .4s;
          transition: .4s;
        }

      input:checked + .slider {
          background-color: #2196F3;
        }

      input:focus + .slider {
          box-shadow: 0 0 1px #2196F3;
        }

      input:checked + .slider:before {
          -webkit-transform: translateX(22px);
          -ms-transform: translateX(22px);
          transform: translateX(22px);
        }

      /* Rounded sliders */
      .slider.round {
          border-radius: 30px;
        }

      .slider.round:before {
          border-radius: 50%;
        }

    </style>
    <!-- Custom styles for this template -->
    
  </head>
  
  
  <body>
    <nav class="navbar navbar-expand-md navbar-dark fixed-top bg-dark">
      <a class="navbar-brand" href="#">Sunrise Light</a>
      <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarsExampleDefault" aria-controls="navbarsExampleDefault" aria-expanded="false" aria-label="Toggle navigation">
          <span class="navbar-toggler-icon"></span>
      </button>

  <div class="collapse navbar-collapse" id="navbarsExampleDefault">
  </div>
</nav>

<main role="main">

  <!-- Main jumbotron for a primary marketing message or call to action -->
  <div class="jumbotron">
    <div class="container">
      <h1 class="display-3">Sunrise Light Control Panel</h1>
      <h2>Current Updates</h2>
      <div class="row">
          <div class="col-md-4">
              <ul class="list-unstyled">
                  <li>
                      <i class="fas fa-thermometer-half"></i>
                      <p id="temperature"></p>
                  </li>
                  <li>
                      <i class="fas fa-tint"></i>
                      <p id="rhumidity"></p>
                  </li>
              </ul>
          </div>
          <div class="col-md-4">
              <ul class="list-unstyled">
                  <li>
                      <i class="fa fa-calendar"></i>
                      <p id="date"></p>
                  </li>
                  <li>
                      <i class="fa fa-clock"></i>
                      <p id="time"></p>
                  </li>
              </ul>   
          </div>
          <div class="col-md-4">
              <ul class="list-unstyled">
                  <li>
                      <i class="fa fa-bed"></i>
                      <p id="alarm_on"></p>
                  </li>
                  <li>
                      <i class="fa fa-sun"></i>
                      <p id="alarm_time"></p>
                  </li>
              </ul>   
          </div>
      </div>
    </div>
  </div>

  <div class="container">
    <!-- Example row of columns -->
    <div class="row">
      <div class="col-md-4">
        <h2>Light</h2>
        <div>
            <label class="switch">
                <input type="checkbox" %light_on%>
                <span class="slider round" onchange="toggleOnOff(this)" id="light_toggle">
            </label>
            Light On/Off
        </div>
        <br>
        <div>
            <button id="setRGB" data-jscolor="{preset: 'dark', onChange: 'setRGB(this)'}"></button>
            <label class="form-check-label" for="setRGB">Pick a color</label>
        </div>
        <br>
        <div>
            <select class="form-select form-select-lg mb-3" aria-label=".form-select-lg example">
              <option selected>Preset Colours</option>
              <option value="1">One</option>
              <option value="2">Two</option>
              <option value="3">Three</option>
            </select>
        </div>
      </div>
      <div class="col-md-4">
        <h2>Date & Time</h2>
        <div>
            <select class="form-select form-select-lg mb-3" aria-label=".form-select-lg example">
              <option selected>Timezone</option>
              <option value="1">One</option>
              <option value="2">Two</option>
              <option value="3">Three</option>
            </select>
        </div>
        
      </div>
      <div class="col-md-4">
        <h2>Alarm</h2>
        <div>
            <label class="form-control-label" for="hr">Alarm Hour</label>
            <input name="alarm_hr" id="hr" type="range" value="7" min="0" max="23" oninput="this.nextElementSibling.value = this.value">
            <output>%alarm_hr%</output>
        </div>
        <div>
            <label class="form-control-label" for="min">Alarm Minutes</label>
            <input name="alarm_min" id="min" type="range" value="15" min="0" max="59" oninput="this.nextElementSibling.value = this.value">
            <output>%alarm_min%</output>
        </div>
        <br>
        <div>
            <label class="switch">
                <input type="checkbox" %alarm_on%>
                <span class="slider round" onchange="toggleAlarm(this)" id="alarm_toggle">
            </label>
            Alarm Active/Idle
        </div>
      </div>
    </div>

    <hr>

  </div> <!-- /container -->

</main>

<footer class="container">
  <p>&copy; Mizu 2023</p>
</footer>
<script src="jquery-3.3.1.min.js"></script>
<script src="bootstrap.bundle.min.js"></script>
<script src="jscolor.js"></script>
</body>
<script>
    // These options apply to all color pickers on the page
    jscolor.presets.default = {
        format:'rgb',
        closeButton:true,
        value: '#000000',
    };
    
    setInterval(
        function() {
            var xhr = new XMLHttpRequest();
            xhr.onreadystatechange = function() {
                if (this.readyState == 4 && this.Status == 200) {
                    var json_response = JSON.parse(this.responseText);
                    console.log(json_response);
                    
                    document.getElementById("temperature").innerHTML = json_response.temp;
                    document.getElementById("rhumidity").innerHTML = json_response.rhum;
                };
            };
            xhr.open("POST", "/dht", true);
            xhr.setRequestHeader("Content-Type", "application/json;charset=UTF-8");
            xhr.send();
        }, 15000
    );
    
    function get_alarm_on(){
        var xhr = new XMLHttpRequest();
        xhr.onreadystatechange = function() {
            if (this.readyState == 4 && this.Status == 200) {
                document.getElementById("alarm_on").innerHTML = this.responseText;
            };
        };
        xhr.open("GET", "/get_alarm_on", true);
        xhr.send();
    }
    

    function toggleAlarm(element) {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "/toggle_alarm", true);
        xhr.send();
    };
    
    function toggleOnOff(element) {
        var xhr = new XMLHttpRequest();
        xhr.open("GET", "/toggle", true);
        xhr.send();
    };
    
    function setRGB(picker){
        var xhr = new XMLHttpRequest();
        var r = Math.round(picker.channel('R'))
        var g = Math.round(picker.channel('G'))
        var b = Math.round(picker.channel('B'))
        xhr.open("GET", "/setRGBW?r="+r+"&g="+g+"&b="+b+"&w=0", true);
        xhr.send();
    };
    jscolor.trigger('change');

</script>
</html>

